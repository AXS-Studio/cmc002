jQuery.autocomplete=function(e,t){function p(){f={};f.data={};f.length=0}function b(){if(h==46||h>8&&h<32)return s.hide();var e=r.val();if(e==u)return;u=e;if(e.length>=t.minChars){r.addClass(t.loadingClass);M(e)}else{r.removeClass(t.loadingClass);s.hide()}}function w(e){var t=$("li",i);if(!t)return;a+=e;a<0?a=0:a>=t.size()&&(a=t.size()-1);t.removeClass("ac_over");$(t[a]).addClass("ac_over")}function E(){var e=$("li.ac_over",i)[0];if(!e){var n=$("li",i);t.selectOnly?n.length==1&&(e=n[0]):t.selectFirst&&(e=n[0])}if(e){S(e);return!0}return!1}function S(n){if(!n){n=document.createElement("li");n.extra=[];n.selectValue=""}var i=$.trim(n.selectValue?n.selectValue:n.innerHTML);e.lastSelected=i;u=i;s.html("");r.val(i);k();t.onItemSelect&&setTimeout(function(){t.onItemSelect(n)},1)}function x(e,t){var n=r.get(0);if(n.createTextRange){var i=n.createTextRange();i.collapse(!0);i.moveStart("character",e);i.moveEnd("character",t);i.select()}else if(n.setSelectionRange)n.setSelectionRange(e,t);else if(n.selectionStart){n.selectionStart=e;n.selectionEnd=t}n.focus()}function T(e){if(h!=8){r.val(r.val()+e.substring(u.length));x(u.length,e.length)}}function N(){var t=j(e),n=200;s.css({width:parseInt(n)+"px",top:t.y+e.offsetHeight+"px",left:t.x+"px"}).show()}function C(){o&&clearTimeout(o);o=setTimeout(k,200)}function k(){o&&clearTimeout(o);r.removeClass(t.loadingClass);s.is(":visible")&&s.hide();if(t.mustMatch){var n=r.val();n!=e.lastSelected&&S(null)}}function L(e,n){if(n){r.removeClass(t.loadingClass);i.innerHTML="";if(!c||n.length==0)return k();$.browser.msie&&s.append(document.createElement("iframe"));i.appendChild(O(n));t.autoFill&&r.val().toLowerCase()==e.toLowerCase()&&T(n[0][0]);N()}else k()}function A(e){if(!e)return null;var n=[],r=e.split(t.lineSeparator);for(var i=0;i<r.length;i++){var s=$.trim(r[i]);s&&(n[n.length]=s.split(t.cellSeparator))}return n}function O(e){var n=document.createElement("ul"),r=e.length;t.maxItemsToShow>0&&t.maxItemsToShow<r&&(r=t.maxItemsToShow);for(var i=0;i<r;i++){var s=e[i];if(!s)continue;var o=document.createElement("li");if(t.formatItem){o.innerHTML=t.formatItem(s,i,r);o.selectValue=s[0]}else{o.innerHTML=s[0];o.selectValue=s[0]}var u=null;if(s.length>1){u=[];for(var f=1;f<s.length;f++)u[u.length]=s[f]}o.extra=u;n.appendChild(o);$(o).hover(function(){$("li",n).removeClass("ac_over");$(this).addClass("ac_over");a=$("li",n).indexOf($(this).get(0))},function(){$(this).removeClass("ac_over")}).click(function(e){e.preventDefault();e.stopPropagation();S(this)})}return n}function M(e){t.matchCase||(e=e.toLowerCase());var n=t.cacheLength?D(e):null;n?L(e,n):typeof t.url=="string"&&t.url.length>0?$.get(_(e),function(t){t=A(t);B(e,t);L(e,t)}):r.removeClass(t.loadingClass)}function _(e){var n=t.url+"?q="+encodeURI(e);for(var r in t.extraParams)n+="&"+r+"="+encodeURI(t.extraParams[r]);return n}function D(e){if(!e)return null;if(f.data[e])return f.data[e];if(t.matchSubset)for(var n=e.length-1;n>=t.minChars;n--){var r=e.substr(0,n),i=f.data[r];if(i){var s=[];for(var o=0;o<i.length;o++){var u=i[o],a=u[0];P(a,e)&&(s[s.length]=u)}return s}}return null}function P(e,n){t.matchCase||(e=e.toLowerCase());var r=e.indexOf(n);return r==-1?!1:r==0||t.matchContains}function H(e,n){n&&r.removeClass(t.loadingClass);var i=n?n.length:0,s=null;for(var o=0;o<i;o++){var u=n[o];if(u[0].toLowerCase()==e.toLowerCase()){s=document.createElement("li");if(t.formatItem){s.innerHTML=t.formatItem(u,o,i);s.selectValue=u[0]}else{s.innerHTML=u[0];s.selectValue=u[0]}var a=null;if(u.length>1){a=[];for(var f=1;f<u.length;f++)a[a.length]=u[f]}s.extra=a}}t.onFindValue&&setTimeout(function(){t.onFindValue(s)},1)}function B(e,n){if(!n||!e||!t.cacheLength)return;if(!f.length||f.length>t.cacheLength){p();f.length++}else f[e]||f.length++;f.data[e]=n}function j(e){var t=e.offsetLeft||0,n=e.offsetTop||0;while(e=e.offsetParent){t+=e.offsetLeft;n+=e.offsetTop}return{x:t,y:n}}var n=this,r=$(e).attr("autocomplete","off");t.inputClass&&r.addClass(t.inputClass);var i=document.createElement("div"),s=$(i);s.hide().addClass(t.resultsClass).css("position","absolute");t.width>0&&s.css("width",t.width);$("body").append(i);e.autocompleter=n;var o=null,u="",a=-1,f={},l=!1,c=!1,h=null;p();if(t.data!=null){var d="",v={},m=[];typeof t.url!="string"&&(t.cacheLength=1);for(var g=0;g<t.data.length;g++){m=typeof t.data[g]=="string"?[t.data[g]]:t.data[g];if(m[0].length>0){d=m[0].substring(0,1).toLowerCase();v[d]||(v[d]=[]);v[d].push(m)}}for(var y in v){t.cacheLength++;B(y,v[y])}}r.keydown(function(e){h=e.keyCode;switch(e.keyCode){case 38:e.preventDefault();w(-1);break;case 40:e.preventDefault();w(1);break;case 9:case 13:if(E()){r.get(0).blur();e.preventDefault()}break;default:a=-1;o&&clearTimeout(o);o=setTimeout(function(){b()},t.delay)}}).focus(function(){c=!0}).blur(function(){c=!1;C()});k();this.flushCache=function(){p()};this.setExtraParams=function(e){t.extraParams=e};this.findValue=function(){var e=r.val();t.matchCase||(e=e.toLowerCase());var n=t.cacheLength?D(e):null;n?H(e,n):typeof t.url=="string"&&t.url.length>0?$.get(_(e),function(t){t=A(t);B(e,t);H(e,t)}):H(e,null)}};jQuery.fn.autocomplete=function(e,t,n){t=t||{};t.url=e;t.data=typeof n=="object"&&n.constructor==Array?n:null;t.inputClass=t.inputClass||"ac_input";t.resultsClass=t.resultsClass||"ac_results";t.lineSeparator=t.lineSeparator||"\n";t.cellSeparator=t.cellSeparator||"|";t.minChars=t.minChars||1;t.delay=t.delay||400;t.matchCase=t.matchCase||0;t.matchSubset=t.matchSubset||1;t.matchContains=t.matchContains||0;t.cacheLength=t.cacheLength||1;t.mustMatch=t.mustMatch||0;t.extraParams=t.extraParams||{};t.loadingClass=t.loadingClass||"ac_loading";t.selectFirst=t.selectFirst||!1;t.selectOnly=t.selectOnly||!1;t.maxItemsToShow=t.maxItemsToShow||-1;t.autoFill=t.autoFill||!1;t.width=parseInt(t.width,10)||0;this.each(function(){var e=this;new jQuery.autocomplete(e,t)});return this};jQuery.fn.autocompleteArray=function(e,t){return this.autocomplete(null,t,e)};jQuery.fn.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1};